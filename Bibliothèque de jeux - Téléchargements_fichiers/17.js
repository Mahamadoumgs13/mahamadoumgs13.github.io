(window.pswCommerceAnywhere=window.pswCommerceAnywhere||[]).push([[17],{263:function(e,t,r){"use strict";r.r(t);var n=r(15),a=r.n(n),o=r(22),c=r.n(o),i=r(56),s=r(1),u=r.n(s),l=r(2),p=r.n(l),d=r(20),m=r.n(d),f=r(21),h=r.n(f),v=r(14),g=r.n(v),w=r(0),y=r(256),_=r(11),b=r(54),C=r(60),k=r(99),O=r(82);function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=g()(e);if(t){var a=g()(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return h()(this,r)}}var S=function(e){m()(r,e);var t=I(r);function r(){return u()(this,r),t.apply(this,arguments)}return p()(r,[{key:"render",value:function(){var e=this.props,t=e.onClose,r=e.qa,n=e.format,a=e.onReload;return w.g.createElement("div",{"data-qa":r},w.g.createElement("div",{className:Object(_.b)("psw-l-line-repel","psw-m-m")},w.g.createElement("h2",{"data-qa":"".concat(r,"#header#title")},n("string","msgid_cart")),w.g.createElement(C.a,{variant:"content",onClick:t,qa:"".concat(r,"#header#close"),className:"psw-top-left",ariaLabel:n("string","msgid_sr_close_dialog")},w.g.createElement(k.a,{type:"close",size:"l"}))),w.g.createElement("div",{className:Object(_.b)("psw-l-stack-center","psw-l-line-center","psw-m-x-l","psw-fill-y","psw-m-t-3xl")},w.g.createElement(O.a,{className:"psw-m-b-s psw-m-t-3xl",namespace:"ps-illustration",type:"error-general-fail",qa:"".concat(r,"#details#image")}),w.g.createElement("span",{className:"psw-h3 psw-m-b-s","data-qa":"".concat(r,"#details#primary")},n("string","msgid_well_didn_work")),w.g.createElement("span",{className:"psw-h6 psw-l-line-center psw-m-b-s","data-qa":"".concat(r,"#details#secondary")},n("string","msgid_we_were_unable_load")),w.g.createElement(C.a,{onClick:a,ariaLabel:n("string","msgid_try_again"),qa:"".concat(r,"#details#tryAgain"),className:"psw-c-accent-1 psw-c-interactive",variant:"content"},w.g.createElement("span",{"data-qa":"".concat(r,"#details#tryAgain#label")},n("string","msgid_try_again")))))}}]),r}(w.d);S.defaultProps={qa:"mfe-cart-error",onClose:function(){},format:function(){},onReload:function(){}};var P=S;function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=g()(e);if(t){var a=g()(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return h()(this,r)}}var j=function(e){m()(r,e);var t=E(r);function r(){return u()(this,r),t.apply(this,arguments)}return p()(r,[{key:"render",value:function(){var e=this.props,t=e.src,r=e.name,n=e.isOpen,a=e.onClose,o=e.open,c=e.openOnMount,i=e.isCartLoading,s=e.shouldShowErrorScreen,u=e.format,l=e.onReload;return w.g.createElement(y.a,{className:"psw-light-theme",openOnMount:c,isOpen:n,onClose:a,onOpen:o},!i&&s&&w.g.createElement(P,{onClose:a,format:u,onReload:l}),i&&w.g.createElement("span",{className:Object(_.b)("psw-center","psw-m-r-m","psw-clip")},w.g.createElement(b.a,{className:"psw-spin",src:"loading-circle-dark.png",useStatic:!0,place:"center",fit:"cover",width:50,aspectRatio:"1:1"})),w.g.createElement("iframe",{"aria-hidden":!n,className:Object(_.b)("psw-fill",{"psw-hide":s}),style:{visibility:i?"hidden":"visible"},title:u("string","msgid_cart_web_checkout"),name:r,src:t,frameBorder:0}))}}]),r}(w.d);j.defaultProps={src:"",isOpen:!1,onClose:function(){},open:function(){},openOnMount:!1,isCartLoading:!0,shouldShowErrorScreen:!1,format:function(){},onReload:function(){}};var A=j,D=r(75),R=r.n(D),L=r(5),T=r.n(L),N=r(240),U=["checkout_cart_cancel","checkout_continue_shopping","checkout_thankyou_dismiss","transact_action_completed","checkout_error_dismiss"],M=[],q=["checkout_signin_required","checkout_password_verification_required"],x=function(){function e(t){var r=this,n=t.name,a=t.clientId,o=t.origin,c=t.loadTimeout,i=t.enableUpsellFlow;u()(this,e),T()(this,"on",(function(){var e;return(e=r._observer).on.apply(e,arguments)})),T()(this,"off",(function(){var e;return(e=r._observer).off.apply(e,arguments)})),T()(this,"startCartLoadTimer",(function(){r.cartLoadTimer=setTimeout((function(){r._observer.emit("showCartError")}),r.loadTimeout)})),T()(this,"clearCartLoadTimer",(function(){return clearTimeout(r.cartLoadTimer)})),T()(this,"_makeNonce",(function(){return Math.round(1e4*Math.random())})),T()(this,"_makeUrl",(function(e){var t=e.route,n=e.queryParams,a=e.addNonce,o=["clientId=".concat(encodeURIComponent(r.clientId))],c=a?["nonce=".concat(r._makeNonce())]:[],i="?".concat(o.concat(n,c).join("&"));return"".concat(r.origin,"/").concat(t).concat(i)})),T()(this,"_makeUrlForPurchase",(function(e){var t=e.type,n=e.skuId,a=e.prologueEmsAlias,o=e.rewardId,c=e.upSellService,i="PS_NOW"===c||"EA_ACCESS"===c;"buynow"===t.toLowerCase()&&"PS_PLUS"===c&&(i=!0);var s=/^(ea|now)--/.test(a),u=i?"subscribe":"".concat(t,"/").concat(n),l=[];return o&&l.push("rewardId=".concat(encodeURIComponent(o))),r.enableUpsellFlow&&(i?l=l.concat("upsell-type=subscribe","emsId=".concat(a)):a&&!s&&l.push("upsell-type=service_".concat(a))),r._makeUrl({route:u,queryParams:l,addNonce:!0})})),T()(this,"_makeUrlForCart",(function(e){return r._makeUrl({route:"cart",queryParams:e?["transact-action=".concat(e)]:[],addNonce:!0})})),T()(this,"_parseMessage",(function(e){var t=(e||{}).data;if(!t)return{};if("object"===R()(t))return t;try{var r=JSON.parse(t);return{nonce:r.nonce,action:r.action,data:r.data}}catch(e){return console.error("json parse error",e),{}}})),T()(this,"_handleMessage",(function(e){if(e.origin===r.origin){var t=r._parseMessage(e),n=t.action,a=t.data;if("checkout_purchase_complete"===n&&r._observer.emit("purchaseComplete",{orderId:a.orderId}),"checkout_item_added"===n&&r._observer.emit("itemAddedToCart",{numItemsInCart:a.numItemsInCart,productId:a.productId,skuId:a.skuId}),"checkout_app_visible"===n&&r._observer.emit("cartVisible"),"checkout_error_visible"===n&&r._observer.emit("errorInCart",{cartAction:a.cartAction,skuId:a.skuId,productId:a.productId}),"checkout_item_removed"===n&&r._observer.emit("itemRemovedFromCart",{numItemsInCart:a.numItemsInCart,productId:a.productId,skuId:a.skuId}),"checkout_redirect_to_game_library"===n){var o=a.gameLibraryUrl;o&&window.open(o,"_self")}if(U.includes(n)&&r._observer.emit("closeCart"),M.includes(n)&&r.reload(),q.includes(n)){var c={redirectUri:a.cartRedirectUri,flow:"checkout_password_verification_required"===n?"web:walletAdmin":""};r._observer.emit("authRequired",c)}}})),this.name=n,this.clientId=a,this.origin=o,this.loadTimeout=c,this.enableUpsellFlow=i,this._observer=new N.a({name:this.name,events:["closeCart","authRequired","purchaseComplete","itemAddedToCart","itemRemovedFromCart","cartVisible","errorInCart","showCartError"]})}return p()(e,[{key:"init",value:function(){"undefined"==typeof window||window.hasMessageHandler||(window.addEventListener("message",this._handleMessage),window.hasMessageHandler=!0)}},{key:"destroy",value:function(){window.removeEventListener("message",this._handleMessage),window.hasMessageHandler=!1,this.off()}},{key:"makeUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.skuId,n=t.prologueEmsAlias,a=t.rewardId,o=t.transactAction,c=t.upSellService,i=/^(add|buynow)$/i.test(e);return i?this._makeUrlForPurchase({type:e,rewardId:a,skuId:r,prologueEmsAlias:n,upSellService:c}):this._makeUrlForCart(o)}},{key:"getCartIframe",value:function(){return document.querySelector('iframe[name="'.concat(this.name,'"]'))}},{key:"reload",value:function(){var e=this.getCartIframe()||{};e.src=e.src}}]),e}();function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var B=function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){T()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},{cart:{make:function(e){return{ui:"CartDrawer",layer:"drawer",scrim:"top",persist:!0,name:e.name,src:e.src,openOnMount:e.openOnMount,actions:{onReload:e.onReload}}}}})};function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var H=function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){T()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},B())},J=r(78);function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach((function(t){T()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var W=function(){function e(){u()(this,e),T()(this,"_openParams",{}),T()(this,"_urlKeys",["cartAction","skuId","prologueEmsAlias","transactAction","upSellService"])}return p()(e,[{key:"stage",value:function(e){this._openParams=e}},{key:"unstage",value:function(){this._openParams={}}},{key:"getSavedAction",value:function(){var e={};try{e=JSON.parse(localStorage.getItem("wca:savedCartAction"))}catch(e){throw new Error("Could not restore cart action from localStorage")}return G(G({},e),J.b.getItems(this._urlKeys))}},{key:"save",value:function(){var e=this;localStorage.setItem("wca:savedCartAction",JSON.stringify(this._openParams)),J.b.setItems(this._urlKeys.reduce((function(t,r){return G(G({},t),{},T()({},r,e._openParams[r]))}),{}))}},{key:"reset",value:function(){localStorage.removeItem("wca:savedCartAction"),J.b.removeItems(this._urlKeys)}}]),e}(),z=r(49),Y=r(257);function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=g()(e);if(t){var a=g()(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return h()(this,r)}}var Q=function(e){m()(r,e);var t=$(r);function r(){return u()(this,r),t.apply(this,arguments)}return p()(r,[{key:"render",value:function(){return w.g.createElement("div",{className:"psw-full-screen psw-pointer-events-off"},w.g.createElement(Y.a,{className:"psw-bottom-left psw-pointer-events-on",force:!1,disableFixedTop:!0}))}}]),r}(w.d);function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var Z=function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){T()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},{gdprConsent:{make:function(){return{ui:"GdprConsent",layer:"notification",persist:!0}}}})},ee=r(260),te=function(e){var t=e.app,r=e.theme,n=document.createElement("div");n.id="psw-layers",n.classList.add("psw-root"),n.classList.add("psw-".concat(r,"-theme")),n.classList.add("psw-layer"),n.classList.add("psw-pointer-events-off"),n.classList.add("psw-allow-scroll"),document.body.appendChild(n),w.g.render(w.g.createElement(ee.a,{format:t.i18n.format,getComponent:t.getComponent,layers:t.layers.getLayers()}),n)},re=r(129);t.default=function(e){var t=e.app,r=e.theme;(te({app:t,theme:r}),function(e){var t=e.app;return{name:"cart",_cartRestorer:new W,_bootstrapCartClient:function(){var e=this;this._cartClient=new x({name:t.config.get("client.webCheckout.name"),clientId:t.config.get("client.webCheckout.clientId"),origin:t.config.get("client.webCheckout.origin"),loadTimeout:t.config.get("client.webCheckout.loadTimeout"),enableUpsellFlow:t.config.get("feature.enableUpsellCtas")}),this._cartClient.init(),this._cartClient.on("purchaseComplete",(function(e){t.emit("cartItemCountUpdate",{numItemsInCart:0},{isPublic:!0}),t.emit("purchaseComplete",e)})),this._cartClient.on("itemAddedToCart",(function(e){t.emit("cartItemCountUpdate",e,{isPublic:!0}),t.emit("itemAddedToCart",e)})),this._cartClient.on("errorInCart",(function(e){return t.emit("errorInCart",e)})),this._cartClient.on("itemRemovedFromCart",(function(e){t.emit("cartItemCountUpdate",e,{isPublic:!0}),t.emit("itemRemovedFromCart",e)})),this._cartClient.on("closeCart",(function(){return e.close()})),this._cartClient.on("authRequired",(function(t){return e._signIn(t)})),this._cartClient.on("cartVisible",(function(){e._cartClient.clearCartLoadTimer(),e._cartDrawer.update({isCartLoading:!1})})),this._cartClient.on("showCartError",(function(){e._cartDrawer.update({isCartLoading:!1,shouldShowErrorScreen:!0})}))},_signIn:function(e){var r=this;return c()(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r._cartRestorer.save(),n.next=3,t.session.signIn(e);case 3:case"end":return n.stop()}}),n)})))()},_bootstrapAndOpenCartDrawer:function(e){var r=this,n=e.src;this._cartDrawer=t.layers.initItem({type:"cart",name:this._cartClient.name,openOnMount:!0,isCartLoading:!0,shouldShowErrorScreen:!1,src:n,onReload:function(){return r.reload()}}),this._cartDrawer.on("close",(function(e){t.emit("clickAwayCloseCart",e)}))},reload:function(){this._cartClient.reload(),this._cartClient.startCartLoadTimer(),this._cartDrawer.update({isCartLoading:!0,shouldShowErrorScreen:!1})},open:function(e){var r=this;return c()(a.a.mark((function n(){var o,c,i,s,u,l,p,d,m,f;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.type,c=e.skuId,i=e.rewardId,s=e.prologueEmsAlias,u=e.transactAction,l=e.upSellService,p=e.ctaDataTrackClick,d=e.telemetryMeta,r._cartRestorer.stage({cartAction:t.session.isUserSignedIn()&&"add"===o?"view":o,skuId:c,prologueEmsAlias:s,transactAction:u,upSellService:l,ctaDataTrackClick:p,telemetryMeta:d}),t.session.isUserSignedIn()){n.next=6;break}return n.next=5,r._signIn();case 5:return n.abrupt("return");case 6:return r._cartClient||r._bootstrapCartClient(),m=r._cartClient.makeUrl(o,{skuId:c,prologueEmsAlias:s,rewardId:i,transactAction:u,upSellService:l}),n.next=10,t.telemetry.appendSmcid(m,d);case 10:f=n.sent,r._cartClient.startCartLoadTimer(),r._cartDrawer?(r._cartDrawer.update({src:f,isCartLoading:!0}),r._cartDrawer.open()):r._bootstrapAndOpenCartDrawer({src:f});case 13:case"end":return n.stop()}}),n)})))()},close:function(){this._cartRestorer.unstage(),this._cartDrawer.close({delay:400})},_restoreCartAfterSignIn:function(){var e=this;return c()(a.a.mark((function r(){var n,o,c,s,u,l,p,d;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e._cartRestorer.getSavedAction(),o=n.cartAction,c=n.skuId,s=n.prologueEmsAlias,u=n.transactAction,l=n.upSellService,p=n.ctaDataTrackClick,d=n.telemetryMeta,!o){r.next=6;break}return r.next=4,e.open({type:o,skuId:c,prologueEmsAlias:s,transactAction:u,upSellService:l});case 4:e._cartRestorer.reset(),"view"!==o&&(a=void 0,a=Object(i.a)(window,"location.hostname"),/^(webstore|store)\./.test(a))&&t.telemetry.capture(null==p?void 0:p.replace(":",":click:"),d);case 6:case"end":return r.stop()}var a}),r)})))()},init:function(){var e=this;return c()(a.a.mark((function r(){return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Object(z.g)({telemetry:t.telemetry,session:t.session}),t.addComponent("CartDrawer",A),t.layers.addLayerItemTypes(H()),r.next=5,e._restoreCartAfterSignIn();case 5:e.removeAddToCartListener=t.on("ADD_TO_CART",(function(t){var r=t.skuId,n=t.prologueEmsAlias,a=t.rewardId,o=t.upSellService,c=t.ctaDataTrackClick,i=t.telemetryMeta,s=void 0===i?{}:i;e.open({type:"add",skuId:r,rewardId:a,prologueEmsAlias:n,ctaDataTrackClick:c,telemetryMeta:s,upSellService:o})})),e.removeBuyNowListener=t.on("BUY_NOW",(function(t){var r=t.skuId,n=t.prologueEmsAlias,a=t.upSellService,o=t.ctaDataTrackClick,c=t.telemetryMeta,i=void 0===c?{}:c;e.open({type:"buynow",skuId:r,prologueEmsAlias:n,ctaDataTrackClick:o,telemetryMeta:i,upSellService:a})})),e.removeOpenCartListener=t.on("OPEN_CART",(function(t){var r=t.transactAction,n=t.ctaDataTrackClick,a=t.telemetryMeta,o=void 0===a?{}:a;e.open({type:"view",transactAction:r,ctaDataTrackClick:n,telemetryMeta:o})}));case 8:case"end":return r.stop()}}),r)})))()},destroy:function(){this._cartDrawer.destroy(),this._cartClient.destroy(),this.removeAddToCartListener(),this.removeBuyNowListener(),this.removeOpenCartListener()}}}({app:t}).init(),Object(re.a)())||function(e){var t=e.app;return{name:"gdprConsent",init:function(){Y.a.configure({instance:t.gdpr}),t.addComponent("GdprConsent",Q),t.layers.addLayerItemTypes(Z()),this._gdprConsentPrompt=t.layers.initItem({type:"gdprConsent"}),this._gdprConsentPrompt.open()},destroy:function(){this._gdprConsentPrompt.close()}}}({app:t}).init()}}}]);